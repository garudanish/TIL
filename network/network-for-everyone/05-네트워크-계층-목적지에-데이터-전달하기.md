# 네트워크 계층: 목적지에 데이터 전달하기

## 네트워크 계층의 역할

### 네트워크 간의 연결 구조

- 이더넷 규칙에 따르면, 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있지만 인터넷이나 다른 네트워크로는 전송할 수 없다.

  - 즉, 데이터 링크 계층의 기능만으로는 해당 네트워크 안에서만 통신이 가능하다.

- 네트워크 계층: **네트워크 간의 통신을 가능하게 하는 계층**
  - 네트워크 간 통신을 위해 **라우터**라는 네트워크 장비가 필요하다.
  - 라우터: 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지를 알려준다.
    - 이때의 목적지 주소는 MAC 주소가 아닌 **IP 주소**이다.
      - MAC 주소로는 다른 네트워크로 데이터를 전송할 수 없다.
  - IP 주소: 어떤 네트워크의 어떤 컴퓨터인지를 구분할 수 있도록 하는 주소
  - 라우팅: 데이터를 어떤 경로로 목적지 IP 주소로 보낼지 결정하는 것
    - 라우터를 이용해 거리에 관계없이 다른 네트워크로 데이터를 보낼 수 있다.
      - 라우터에는 라우팅 테이블이 있어서, 경로 정보를 등록하고 관리한다.

### IP란?

- 네트워크 계층에서는 캡슐화할 때 IP 헤더를 붙인다.
  - 버전, 헤더 길이, 서비스 유형, 전체 패킷 길이, ID, 조각 상태, 조각의 위치, TTL, 프로토콜, 헤더 체크섬, 출발지 IP 주소, 목적지 IP 주소 순으로 헤더 정보가 구성되어 있다
  - IP 헤더를 붙인 데이터를 **IP 패킷**이라고 한다.

## IP 주소의 구조

### IP 주소란?

- IP 주소는 인터넷 서비스 제공자에게 받을 수 있다.
  - IPv4:
    - 현재 주로 사용한다
    - 32비트로 되어 있어 IP 주소를 약 43억 개 만들 수 있다.
  - IPv6:
    - 128비트로 되어 있어 매우 많은(2^128) IP 주소를 만들 수 있다.
    - 인터넷의 보급으로 IP 주소 부족 문제를 해결하기 위해 사용한다.
- IP 주소에는 공인 IP 주소와 사설 IP 주소가 있다.
  - 공인 IP 주소:
    - 인터넷 서비스 제공자가 제공한다.
    - 인터넷에 직접 연결되는 컴퓨터나 라우터에는 공인 IP 주소를 할당한다.
  - 사설 IP 주소:
    - 랜에 연결된 컴퓨터는 사설 IP 주소를 할당한다.
    - 사용 가능한 IP 주소 고갈 문제로, 랜 안의 컴퓨터는 사설 IP 주소를 직접 할당하거나 라우터의 DHCP 기능을 사용해 자동 할당한다.
- 공인 IP 주소와 사설 IP 주소는 모두 2진수의 32비트를 사용한다.
  - MAC 주소는 48비트로 구분하기 쉽도록 16진수를 사용하고, IP 주소는 32비트로 구분하기 쉽도록 10진수로 표시한다.
  - 32개 비트를 8비트 단위인 옥텟으로 나눠서 표시한다.
  - IP 주소는 10진수로 표시하지만 실제로는 2진수로 되어있다.
- IP 주소는 네트워크 ID와 호스트 ID로 나누어져 있다.
  - 네트워크 ID: 어떤 네트워크인지를 나타낸다.
  - 호스트 ID: 해당 네트워크의 어떤 컴퓨터인지를 나타낸다.

## IP 주소의 클래스 구조

### IP 주소 클래스란?

- IPv4의 IP 주소는 비트로 구분하지만, 네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어 네트워크 크기를 조정할 수 있다.
- 네트워크 크기는 **클래스**라는 개념으로 구분한다.
- 클래스에는 A - E 다섯 개 클래스가 있다. 일반 네트워크에서는 A - C 클래스까지 사용할 수 있다.
  - A 클래스: 대규모 네트워크 주소
    - 첫 8비트가 네트워크 ID, 이후 24비트가 호스트 ID
  - B 클래스: 중형 네트워크 주소
    - 첫 16비트가 네트워크 ID, 이후 16비트가 호스트 ID
  - C 클래스: 소규모 네트워크 주소
    - 첫 24비트가 네트워크 ID, 이후 8비트가 호스트 ID
  - D 클래스: 멀티캐스트 주소
  - E 클래스: 연구 및 특수용도 주소
- 각 클래스의 첫 옥텟의 범위는 각각 다르게 설정되어 있으며, 따라서 공인 IP 주소의 범위 또한 다르게 설정된다.
  - 사설 IP 주소의 범위 역시 각 클래스마다 공인 IP 주소와는 겹치지 않게 설정되어 있다.

## 네트워크 주소와 브로드캐스트 주소의 구조

### 네트워크 주소와 브로드캐스트 주소란?

- IP 주소에는 네트워크 주소와 브로드캐스트 주소가 있다.
  - 이 두 주소는 컴퓨터나 라우터가 IP로 사용할 수 없다.
  - 네트워크 주소:
    - 호스트 ID가 10진수로 0 (e.g., `192.168.1.0`)
    - 전체 네트워크에서 작은 네트워크를 식별하는데 사용되며, 네트워크 주소는 전체 네트워크의 대표 주소이다.
    - 가령 `192.168.1.1` - `192.168.1.6`은 모두 `192.168.1.0`의 네트워크에 있다.
  - 브로드캐스트 주소:
    - 호스트 ID가 10진수로 255 (e.g., `192.168.1.255`)
    - 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는데 사용한다.
    - 가령 `192.168.1.255`로 데이터를 전송하면 같은 네트워크 안에 있는 모든 컴퓨터로 송신된다.

## 서브넷의 구조

### 서브넷이란?

- A 클래스의 네트워크는 IP 주소를 1677만 여개를 사용할 수 있다.
  - 많은 수의 컴퓨터에 패킷이 전송되어 네트워크가 지연되는 것을 막기 위해 **대규모 네트워크를 작은 네트워크로 분할**해 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있다.
- 서브넷팅: **네트워크를 분할하는 것**
- 서브넷: **분할된 네트워크**
  - 서브넷팅하면 IP 주소가 네트워크 ID, 서브넷 ID, 호스트 ID로 나누어지게 된다.
    - 원래 호스트 ID로 사용되던 비트를 서브넷 ID로 바꾼다.

### 서브넷 마스크란?

- 서브넷팅한 IP 주소의 네트워크 ID와 호스트 ID를 구분하기 위해 서브넷 마스크를 사용한다.
- 서브넷 마스크: 네트워크 ID와 호스트 ID를 식별하기 위한 값
  - 32비트의 값으로, A-C 클래스는 각각 `255.0.0.0`, `255.255.0.0`, `255.255.255.0`이다.
  - 프리픽스 표기법으로 서브넷 마스크를 `/비트 수`로 나타낼 수 있다.
- C 클래스를 서브넷팅하면 기존 네트워크 ID 24비트 + 서브넷 ID 4비트로, 프리픽스 표기법으로는 `/28`이다.

## 라우터의 구조

### 라우터란?

- 라우터는 네트워크를 분리할 수 있다.
  - 스위치만 있는 네트워크는 모든 컴퓨터와 스위치가 동일한 네트워크에 속한다.
- 다른 네트워크에 데이터를 전송하려면 라우터의 IP 주소를 설정해야 한다.
  - 이는 네트워크의 출입구를 설정하는 것으로, **기본 게이트웨이**라고 한다.
  - 다른 네트워크로 데이터를 보낼 때 어디로 전송해야 하는지 알지 못하므로, 네트워크의 출입구를 지정하고 일단은 데이터를 전송한다.

### 라우팅이란?

- 라우팅: 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송하는 것
  - 라우팅 테이블: 경로 정보가 등록되어 있는 테이블
- 라우팅 프로토콜: 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜
  - RIP, OSPF, BGP 등이 있다.
