# Chaptor 04. 테스트 구축하기

- 리팩터링은 분명 가치 있는 도구지만, 그것만으로는 부족하다. 리팩터링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트가 뒷받침돼야 한다.

## 4.1 자가 테스트 코드의 가치

- 프로그래머들이 어떻게 일하는지 가만히 살펴보면 실제로 코드를 작성하는 시간의 비중은 그리 크지 않음을 발견할 수 있다.
- 버그 수정 자체는 대체로 금방 끝난다. 진짜 끔찍한 건 버그를 찾는 여정이다.
- 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자.
- 직전까지 테스트가 성공했다면 마지막 테스트 이후에 작성한 코드에서 버그가 발생했음을 알 수 있다.이런 테스트를 몇 분 간격으로 자주 수행했기 때문에 버그가 발생한 지점은 조금 전에 작성한 코드에 있다는 사실도 알 수 있었다. 이렇게 하지 않았다면 몇 시간이 걸렸을지 모를 버그를 단 몇 분이면 해결할 수 있었다.
- 테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다.
- 사실 다른 사람에게 이런 식으로 개발하라고 설득하기는 녹록지 않다. 테스트를 작성하려면 소프트웨어 제품 본체 외의 부가적인 코드를 상당량 작성해야 한다. 그래서 테스트가 실제로 프로그래밍 속도를 높여주는 경험을 직접 해보지 않고서는 자가 테스트의 진가를 납득하긴 어렵다.

![테스트 코드를 비아냥거리는 글](https://github.com/garudanish/TIL/assets/73154157/15bc9122-d821-4300-9ce0-8a95484604f2)

- 테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다. (...) 테스트를 모두 통과한 시점이 바로 코드를 완성한 시점이다.
- 리팩터링에는 테스트가 필요하다. 그러니 리팩터링하고 싶다면 테스트를 반드시 작성해야 한다.

## 4.3 첫 번째 테스트

- 실패해야 할 상황에서는 반드시 실패하게 만들자.
- 자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자.
- 실전에서는 테스트의 수는 수천 개 이상일 수 있다. 뛰어난 테스트 프레임워크를 사용한다면 이렇게 많은 테스트도 간편하게 실행할 수 있고 무언가 실패한다면 금방 확인할 수 있다. 간결한 피드백은 자가 테스트에서 매우 중요하다.

## 4.4 테스트 추가하기

- 명심하자! 테스트는 위험 요인을 중심으로 작성해야 한다! 테스트의 목적은 어디까지나 현재 혹은 향후에 발생하는 버그를 찾는 데 있다. 따라서 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요가 없다. 이런 코드는 너무 단순해서 버그가 숨어들 가능성도 별로 없다.
- 완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다.
- 일반 코드와 마찬가지로 테스트 코드에서도 중복은 의심해봐야 한다.
- [중복을 제거하려 바깥 범위로 끌어내는 방법을 사용하면] 테스트 관련 버그 중 가장 지저분한 유형인 '테스트끼리 상호작용하게 하는 공유 픽스처'를 생성하는 원인이 된다.
- `beforeEach` 구문은 각각의 테스트 바로 전에 실행되어 `asia`를 초기화하기 때문에 모든 테스트가 자신만의 새로운 `asia`를 사용하게 된다. 이처럼 개별 테스트를 실행할 때마다 픽스처를 새로 만들면 모든 테스트를 독립적으로 구성할 수 있어서, 결과를 예측할 수 없어 골치를 썩는 사태를 예방할 수 있다.

## 4.6 경계 조건 검사하기

- 지금까지 작성한 테스트는 모든 일이 순조롭고 사용자도 우리 의도대로 사용하는, 일명 '꽃길 happy path' 상황에 집중하였다. 그런데 이 범위를 벗어나는 경계 지점에서 문제가 생기면 어떤 일이 벌어지는지 확인하는 테스트도 함께 작성하면 좋다.
- 나는 (...) 컬렉션과 마주하면 그 컬렉션이 비었을 때 어떤 일이 일어나는지 확인하는 편이다.
- 숫자형이라면 0일 때를 검사해본다. 음수도 넣어보면 좋다.
- 경계를 확인하는 테스트를 작성해보면 프로그램에서 이런 특이 상황을 어떻게 처리하는 게 좋을지 생각해볼 수 있다.
- 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자.
- 그렇다면 테스트를 어느 수준까지 해야 할까? (...) 테스트에도 수확 체감 법칙이 적용된다. (...) 따라서 위험한 부분에 집중하는 게 좋다. 코드에서 처리 과정이 복잡한 부분을 찾아보자. 함수에서 오류가 생길만한 부분을 찾아보자. 테스트가 모든 버그를 걸러주지는 못할지라도, 안심하고 리팩터링할 수 있는 보호막은 되어준다.

## 4.7 끝나지 않은 여정

- 버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.
