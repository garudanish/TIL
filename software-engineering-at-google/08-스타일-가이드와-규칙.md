# Chapter 08. 스타일 가이드와 규칙

- 대부분의 엔지니어링 조직에는 내부 코드베이스를 관리하는 규칙이 있고, 소프트웨어 엔지니어 대부분은 조직에서 허용하는 정책 범위 안에서 코드를 작성한다.
- 규칙*rule*은 법이라서 반드시 지켜야 하지만, 지침*guidance*은 권장사항이라서 다소 변형해 적용해도 괜찮다.
- 스타일 가이드는 코드를 지배하는 종합적인 규약 모음집이다.
- 크게 봤을 때 모든 가이드의 목표는 `코드의 '지속 가능성'을 높이도록 이끄는 것`이다.
- 조직마다 코드베이스가 충족시켜야 할 요구들이 다르므로, 그에 합당한 규칙들로 꾸려져야 한다.

## 8.1 규칙이 필요한 이유

- 규칙을 관리하는 목표는 `'좋은' 행동을 장려하고 '나쁜' 행동을 억제하기 위해서`이다.
  - 좋고 나쁨의 해석은 조직이 추구하는 가치에 따라 달라진다. 따라서 조직이 추구하는 가치를 가장 먼저 파악해야 한다.
- 확립된 규칙과 지침은 조직이 커지더라도 일관되게 통용되는 공통의 코딩 어휘가 되어준다.

## 8.2 규칙 만들기

- 목표에 집중하면 규칙이 따라온다.

### 8.2.1 기본 원칙 안내

- 구글 규칙 모음의 기본 원칙은 `규모와 시간 양쪽 측면에서 탄력적인 엔지니어링 환경이 지속되도록 하는 것`이다.
- 이 원칙의 트레이드 오프는 엔지니어의 자유를 제한한다는 점이다.
- 따라서 규칙을 만들 때 염두에 두어야 하는 중요한 원칙들이 있다;
  - 규칙의 양을 최소화한다.
  - 읽는 사람에게 맞춘다.
  - 일관되어야 한다.
  - 오류가 나기 쉽거나 예상치 못한 동작을 유발하는 구조를 피한다.
  - 꼭 필요하다면 실용성을 생각해 예외를 허용한다.

#### 규칙의 양을 최소화한다

- 규칙이 많아지면 규칙 모음을 관리하기도 어렵고 그만큼 (학습) 비용도 커진다.
- 너무 자명한 규칙은 의도적으로 배제한다.

#### 읽는 사람에게 맞춘다

- 코드는 작성되는 횟수보다 읽히는 횟수가 더 많으며 시간이 지날수록 차이가 벌어진다.
- 코드가 하려는 일이 무엇인지를 읽는 사람이 즉시 알 수 있어야 한다.
- 행위가 헷갈리거나 오해할 수 있는 상황에서는 의도한 행위를 알려주는 근거가 더욱 중요하다.
- 다른 코드를 찾아보거나 참조할 필요 없이, 함수의 구현부를 들여다보지 않고도 호출 지점에서 무슨 일이 벌어지는지를 명확히 이해할 수 있도록 하는 것이 목적이다.
- 주석과 관련한 규칙 대부분도 읽는 이를 위해 적소에 증거를 남기라는 이 목표를 뒷받침하도록 설계되었다.
  - 문서화 주석(해당 파일, 클래스, 함수의 앞에 추가되는 블록 주석): 뒤따르는 코드의 설계나 의도를 설명한다.
  - 구현 주석(코드 자체에 산재하는 주석): 뻔하지 않은 선택을 한 이유를 해명하거나 주의할 점을 알려주고, 까다로운 부분의 로직을 설명하고, 중요한 부분을 강조한다.

#### 일관되어야 한다

- 구글에는 다양한 지역에 사무실이 있고 사무실마다 인테리어는 다르지만, 일하는 데 필요한 모든 시스템은 의도적으로 동일하게 관리한다.
- 코드가 일관되게 작성되어 있다면 엔지니어들은 익숙지 않은 부분을 살펴볼 일이 생겨도 상당히 빠르게 작업을 이어갈 수 있다.

#### 일관성이 안겨주는 이점

- 일관성이 구속처럼 느껴질 수도 있지만, 더 많은 엔지니어가 더 많은 일을 적은 노력으로 수행할 수 있게 된다.
- 코드베이스의 스타일과 기준이 일관되면 코드를 작성하는 엔지니어와 읽는 이들은 '어떻게' 표현하느냐가 아닌 '무엇을' 수행하느냐에 집중할 수 있다.
- 일관성은 규모를 확장하기 쉽게 도와준다. 모두가 같은 규칙을 따라 코드를 구성한다면 수많은 관리 작업을 자동화해주는 도구를 제작할 수 있다.
- 일관성은 인력을 늘리는 데도 도움이 된다. 모든 사람이 참여하는 코드를 가능한 한 일관성 있게 관리하면 엔지니어들이 새로운 팀으로 옮겨 적응하는 시간이 단축된다.
- 일관성은 시간 관점에서도 탄력성을 보장한다. 시간이 흐르면서 인력 유출입이 발생하는데, 이때 코드베이스가 일관되어 있다면 전환 비용이 낮아지고 코드와 엔지니어 모두 거의 제약 없이 재배치 될 수 있다.

#### 표준 정하기

- '일관되게 하라'를 지켜야 하는 범위는 작게 시작해서 점차 확장된다.(파일 하나 > 팀의 규약 > 프로젝트 > 전체 코드베이스)
- 때로는 외부 커뮤니티에서 정착된 표준도 고려해야 한다.
- 일반적으로는 규약은 바깥세상과 일관되게 잡는 편이 유리하다.

#### 오류를 내기 쉽거나 예상과 다르게 동작할 여지가 있는 구조는 피하자

- 복잡한 기능을 정확하게 이해하지 못한 채 사용하면 그 복잡성 때문에 오용하여 버그를 유발하기 쉽다.
- 언어의 고급 기능들은 기능을 잘 이해하고 활용하는 전문가에게는 이상적인 해법일 수 있지만 일반적으로는 이해하기 더 어렵고 널리 쓰이지 않는다.

#### 실용적 측면을 인정하자

- 꼭 필요하다면 최적화나 실용성을 위해 예외를 허용한다.
- 일관성과 가독성을 희생해서라도 성능을 끌어올려야 한다면 예외를 허용한다.
- 직접 만들지 않은 외부 코드와 연동되도록 설계된 코드는 대상 코드와 잘 어우러지게 작성해야 더 효율적일 수 있다.

### 8.2.2 스타일가이드

- 모든 스타일 가이드 규칙은 세 범주로 나눌 수 있다.
  - 위험을 피하기 위한 규칙
  - 모범 사례를 적용하기 위한 규칙
  - 일관성을 보장하기 위한 규칙

#### 위험 회피하기

- 스타일 가이드에는 사용하기 어렵거나 올바르게 사용하기가 까다로운 기능에 관한 판단이 담긴다.

#### 모범 사례 강제하기

- 모범 사례를 강제로 따르도록 하는 규칙은 코드베이스를 건실하고 관리 가능하게 지켜준다.
- 모범 사례 중 일부는 소스 코드의 가독성을 높이도록 설계되었다.
- 새롭거나 아직 널리 이해되지 못한 언어 기능은, 등장 초기에는 올바른 사용 가이드를 만들기 어려울 수도 있으므로 제한하기도 한다.

#### 일관성 구축하기

- 사소한 규칙들은 '무엇'을 선택했냐가 아니라 '선택을 했다'는 사실에 의의가 있다.

## 8.3 규칙 수정하기

- 스타일 가이드는 고정불변이 아니다.
- 구글 스타일 가이드에 규칙을 추가할 때는 장단점과 잠재적인 파장을 분석하고, 결정을 실행하는 데 수반되는 변경량이 조직 규모에서 무리가 없는지 검증하는 데 많은 시간을 쓴다.
- 각 결정에 이른 근거를 문서로 남겨두면 규칙을 변경해야 할 때가 언제인지를 알아내기 쉬워진다.

### 8.3.1 프로세스

- 구글의 스타일 가이드 수정 프로세스는 해법을 중심으로 돌아간다.
- 구글에서의 스타일 가이드 수정 대부분은 커뮤니티에서의 토론으로부터 출발한다.
- 스타일 가이드 수정 제안은 완벽한 형태일 수도 있고, 모호한 질문에서 시작할 수도 있다. 어쨌든 던져진 아이디어는 커뮤니티의 검토를 거치고, 검토 결과에 따라 최종 승인 단계로 넘어간다.

### 8.3.2 스타일 중재자

- 구글 스타일 가이드들은 언어별로 최종 결정과 승인을 책임지는 소유자가 따로 있고, 이들을 스타일 중재자*style arbiter*라고 부른다.
- 스타일 가이드 수정 여부는 제안된 수정에 따르는 엔지니어링 측면의 트레이드오프를 논의하여 결정하며, 중재자는 스타일 가이드가 지향하는 목표에 입각해 판단한다.

### 8.3.3 예외

- 규칙들은 대체로 더 범용적으로 쓰일 수 있게 설계되므로, 특정 상황에서는 일부 규칙을 적용하지 않아도 되게끔 예외를 허용하는 게 이득일 때도 있다.
- 예외 허용은 가볍게 이루어지지 않는다. 규칙을 따르기보다 예외를 인정하는 쪽이 이득이라고 판단될 때만 예외를 허용한다.

## 8.4 지침

- 지침은 복잡한 주제에 관한 길고 깊은 논의부터, 권장하는 모범 사례에 관한 짧고 집중적인 조언까지 다양하다.
- 지침은 주로 사람들이 자주 실수하는 것 혹은 아직 익숙지 않은 새로운 주제라서 혼란스러워하는 것들에 집중한다.
- 지침의 예시로 입문서*primer*가 있다. 입문서는 가이드가 권장하는 기능을 자세하게 설명한다.
- 구글의 지침서 중 하나로 '금주의 팁'이 있다. 이 지침은 추상적인 예시가 아니라 실제로 목격된 패턴에서 뽑아낸 조언이라서 실무에서 광범위하고 즉각적으로 적용할 수 있었다.

## 8.5 규칙 적용하기

- 규칙을 정해도 적용하지 않으면 의미가 없다.
- 규칙을 강제하는 방법으로는 1) 교육과 훈련을 통한 방법, 2) 도구를 이용한 방법이 있다.
  - 구글의 훈련 프로그램은 코드 리뷰가 중심이다.
  - 규칙이 실제로 지켜지는지를 확인하는 데는 사람보다는 되도록 자동화 도구를 활용한다.
- 도구를 활용해 규칙이 자동으로 반영되게 하면 시간이 흐르거나 조직이 커져도 몇몇 규칙이 실수로 누락되거나 잊혀지는 일을 방지할 수 있다.
- 도구를 활용하면 규칙을 미묘하게 다르게 해석하거나 적용하는 일을 최소한으로 줄여준다.
- 도구를 활용하더라도 모든 규칙을 강제로 적용하기는 불가능할 수 있다. 판단이 필요한 규칙들이 그 경우이다.
- 기술보다는 사회적 문제를 다루는 규칙도 있으며, 사회적 문제를 기술적 시각으로 해결하려는 것은 현명하지 않다.
  - 사회적 문제: 가치 판단(코드의 크기가 **작다**) 등

### 8.5.1 오류 검사기

- 언어 사용법과 관련한 대부분의 규칙들은 정적 분석 도구로 강제할 수 있다.

### 8.5.2 코드 포맷터

- 자동 스타일 검사기와 포맷터를 적극적으로 이용하면, 사소한 스타일 문제는 스타일 검사기에 맡기고 엔지니어들은 로직 구현에 집중할 수 있다.
- 행렬 포맷팅 같은 특이 상황을 제외하고는 도구가 잘못 포맷팅하는 일은 거의 없다.
- 구글은 코드를 저장소에 푸시하기 전 빌드 인프라의 서비스가 포맷터를 수행하는 프리서브밋 검사*presubmit check*로 포맷터를 반드시 사용하게 한다.

## 8.6 마치며

- 모든 조직에는(그리고 큰 조직일 수록) 코드베이스의 복잡성을 관리하여 감당할 수 있는 수준으로 유지하는 데 규칙이 큰 도움이 된다.

## 8.7 핵심정리

- 규칙과 지침의 목표는 시간 확장 관점에서의 탄력성을 높이는 것이어야 한다.
- 상황이 변하면 규칙도 달라져야 하니 규칙이 만들어진 근거 데이터를 알고 있어야 한다.
- 모든 것을 규칙으로 강제해서는 안 된다.
- 일관성이 핵심이다.
- 가능한 한 규칙들이 자동으로 적용되도록 해야 한다.
