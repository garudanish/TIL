# Chapter 09. 코드 리뷰

- 코드 리뷰는 작성자 이외의 사람이 코드를 검토하는 프로세스로, 주로 코드를 코드베이스에 반영하기 전에 수행한다.
- 코드 리뷰를 효과적으로 하려면 일반적으로 절차와 지원 도구를 잘 활용해야 한다.
- 확실한 이점('버그가 코드 베이스로 침투하기 전에 잡아낸다')과 미묘한 이점들을 제공한다.

## 9.1 코드 리뷰 흐름

- 코드 리뷰는 커밋 직전 등 소프트웨어 개발 단계 곳곳에서 이루어질 수 있다.
- 구글의 코드 리뷰는 보통 다음 절차대로 진행된다.
  1. 작성자가 변경 사항을 작성하고, 스냅샷을 만들어 코드베이스와의 diff를 뜬다.
  2. 작성자는 초기 패치를 사용해 자동 리뷰 의견을 받거나 스스로 리뷰를 해본다.
  3. 리뷰어들은 코드 리뷰 도구에서 diff에 댓글로 의견을 남긴다.
  4. 작성자는 피드백을 기초로 변경을 수정하고 새로운 스냅샷을 업로드한 후 리뷰어들에게 회신한다. (iii, iv단계는 여러 차례 반복될 수 있다.)
  5. 리뷰어들이 변경 내용에 모두 만족하면 LGTM 태그를 달아준다.
  6. 변경에 LGTM이 달리고, 모든 댓글을 해결하고, 변경이 승인되면, 작성자는 코드베이스에 커밋할 수 있다.

> - 코드는 그 자체로 부채임을 인정하고 잊지 말아야 한다
> - 새로운 기능 개발을 시작하기 앞서 정말 새로운 기능이 맞는지를 주의 깊게 살펴야 한다.
> - 이상적으로는 중복 확인이 먼저 이루어져야 하고, 무엇이 됐든 새로운 걸 설계할 때는 코드 작성 전에 관련 그룹과 대화를 나눠봐야 한다.
> - 코드 리뷰는 전에 내린 설계를 번복하거나 재논의하는 자리여서는 안 된다.

## 9.2 코드 리뷰 @ 구글

- 구글에서는 어떤 변경이든 '승인'을 얻으려면 세 가지 측면에서의 리뷰를 통과해야 한다.
  1. 다른 엔지니어로부터 정확성*correctness*과 이해 용이성*comprehension*을 평가받는다.
  2. 변경되는 코드 영역을 관리하는 코드 소유자*code owner*로부터 변경 코드가 적절하다는 승인을 받는다.
  3. 누군가로부터 가독성 승인을 받는다.
- 대부분의 리뷰는 세 역할을 모두 수행할 수 있는 사람 한 명이 처리하기 때문에 이 절차들이 빠르게 진행된다.
- 승인을 두 개 이상 언어야 하는 코드 리뷰 대부분은 두 단계로 진행된다.
  1. 동료 엔지니어로부터 LGTM을 받는다.
     1. 동료 엔지니어는 코드가 정확한지와 변경된 코드가 유효한지에 집중한다.
  2. 해당 코드 소유자와 가독성 인증자에게 승인을 요청한다.
     1. 코드 소유자는 자신이 맡은 코드베이스에 적합한 변경인지에 집중한다.
- 세 가지 역할을 나눔으로써 코드 리뷰 프로세스를 더 유연하게 운영할 수 있다.

## 9.3 코드 리뷰의 이점

- 소프트웨어 업계에서 코드 리뷰가 필요하다는 데는 논란의 여지가 없지만 구체적인 모습은 아주 제각각이다.
- 코드 리뷰는 구글의 소프트웨어 엔지니어 모두가 반드시 따라야 하는 몇 안 되는 전사적인 프로세스다.
- 잘 설계된 코드 리뷰 프로세스와 코드 리뷰를 중요하게 다루는 문화가 주는 대표적인 이점은 다음과 같다.
  1. 코드가 정확한지 확인해준다
  2. 변경된 코드를 다른 엔지니어도 잘 이해한다
  3. 코드베이스가 일관되게 관리된다
  4. 팀이 소유권(주인의식)을 더 강하게 느낀다
  5. 지식이 공유된다
  6. 코드 리뷰 자체의 기록이 남는다

### 9.3.1 코드 정확성

- 리뷰어는 일차적으로 변경된 코드의 '정확성'을 확인해주며, 코드 리뷰가 주는 가장 확실한 이점이다.
- 코드 리뷰에 들이는 시간은 테스트, 디버그, 회귀 테스트에 투입되는 시간을 줄여준다.
- 리뷰어는 자신이 선호한다는 이유로 다른 안을 주장해서는 안 된다.
- 정적 분석이나 자동화 테스트 등을 활용해 많은 정확성 검사를 자동으로 수행할 수 있다.
- 도구의 힘은 커졌지만 초기 코드 리뷰 프로세스에서 결함을 찾는 일은 여전히 원점 회귀 전략에 필수다.
- 코드 리뷰는 소프트웨어 개발에서 결함에 대처하는 여러 방어 수단 중 한 축이다.

### 9.3.2 코드 이해 용이성

- 코드 리뷰는 주어진 변경이 수많은 다른 사람에게도 쉽게 이해되는지를 평가하는 첫 번째 시험대이다.
- 리뷰어는 작성자가 선택한 설계를 존중해야 한다. 하지만 그와 별개로 코드가 잘 이해되지 않으면 질문을 던져보는 건 좋다.

### 9.3.3 코드 일관성

- 리뷰어는 코드 리뷰 과정에서 주어진 코드가 코드베이스의 표준을 얼마나 잘 따르는가를 평가할 수 있다.
- 가독성 승인자의 임무는 주어진 코드가 다음 사항들을 잘 만족하는지를 검토하는 것이다.
  1. 해당 프로그래밍 언어의 모범 사례들을 잘 따라야 한다
  2. 구글 코드 리포지터리에ㅓ 같은 언어로 작성된 다른 코드들과 일관되어야 한다
  3. 필요 이상으로 복잡하지 않아야 한다
- 코드는 일관되고 단순해야지 사람들이 쉽게 이해할 수 있고 리팩터링 도구가 더 쉽게 다룰 수 있다.
- 코드베이스 전체의 코드를 일관되게 관리하면 모든 엔지니어의 이해도가 향상되고, 코드 리뷰 프로세스에도 긍정적인 영향을 준다.
- 코드베이스가 일관되면 다른 팀의 프로젝트 코드도 한결 수월하게 리뷰할 수 있다.

### 9.3.4 심리적, 문화적 이점

### 9.3.5 지식 공유

## 9.4 코드 리뷰 모범 사례

### 9.4.1 공손하고 전문가답게

### 9.4.2 작게 변경하기

### 9.4.3 변경 서령 잘쓰기

### 9.4.4 리뷰어는 최소한으로

### 9.4.5 가능한 한 자동화하기

## 9.5 코드 리뷰 유형

### 9.5.1 그린필드 코드 리뷰

### 9.5.2 동작 변경, 개선, 최적화

### 9.5.3 버그 수정과 롤백

### 9.5.4 리팩터링과 대규모 변경

## 9.6 마치며

## 9.7 핵심 정리
